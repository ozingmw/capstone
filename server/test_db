drop database dayclover;
create database dayclover;

use dayclover;

# 사용자 테이블에서 사용자가 disabled가 되고 2주가 지나면 사용자를 삭제하는 이벤트 생성
# SET GLOBAL event_scheduler = ON
# ;

CREATE DEFINER=`sycblkfykf`@`%` EVENT `delete_old_users`
	ON SCHEDULE
		EVERY 1 DAY STARTS '2024-01-01'
	ON COMPLETION NOT PRESERVE
	ENABLE
	COMMENT ''
	DO DELETE FROM user WHERE disabled_at <= DATE_SUB(NOW(), INTERVAL 14 DAY)
;

# 테이블 생성
CREATE TABLE user (
	user_id INT(11) NOT NULL AUTO_INCREMENT,
	email VARCHAR(50) NOT NULL COLLATE 'utf8mb4_general_ci',
	hashed_token VARCHAR(100) NOT NULL COLLATE 'utf8mb4_general_ci',
	nickname VARCHAR(20) COLLATE 'utf8mb4_general_ci',
	photo_url VARCHAR(100) NULL DEFAULT NULL COLLATE 'utf8mb4_general_ci',
	age TINYINT(3) NULL DEFAULT NULL,
	gender ENUM('M','F') NULL DEFAULT NULL COLLATE 'utf8mb4_general_ci',
	disabled TINYINT(1) NOT NULL DEFAULT '0',
	disabled_at DATE NULL DEFAULT NULL,
	PRIMARY KEY (user_id) USING BTREE
)
COLLATE='utf8mb4_general_ci'
ENGINE=InnoDB
;

CREATE TABLE sentiment (
	sentiment_id INT(11) NOT NULL AUTO_INCREMENT,
	sentiment_content VARCHAR(8) NOT NULL COLLATE 'utf8mb4_general_ci',
	PRIMARY KEY (sentiment_id) USING BTREE
)
COLLATE='utf8mb4_general_ci'
ENGINE=InnoDB
;

CREATE TABLE question (
	question_id INT(11) NOT NULL AUTO_INCREMENT,
	question_content VARCHAR(255) NOT NULL COLLATE 'utf8mb4_general_ci',
	PRIMARY KEY (question_id) USING BTREE
)
COLLATE='utf8mb4_general_ci'
ENGINE=InnoDB
;

CREATE TABLE quote (
	quote_id INT(11) NOT NULL AUTO_INCREMENT,
	sentiment_id INT(11) NOT NULL,
	quote_content VARCHAR(255) NOT NULL COLLATE 'utf8mb4_general_ci',
	PRIMARY KEY (quote_id) USING BTREE,
	INDEX sentiment_id (sentiment_id) USING BTREE,
	CONSTRAINT quote_ibfk_1 FOREIGN KEY (sentiment_id) REFERENCES sentiment (sentiment_id) ON UPDATE RESTRICT ON DELETE RESTRICT
)
COLLATE='utf8mb4_general_ci'
ENGINE=InnoDB
;

CREATE TABLE diary (
	diary_id INT(11) NOT NULL AUTO_INCREMENT,
	user_id INT(11) NOT NULL,
	sentiment INT(11) NOT NULL,
	diary_content VARCHAR(255) NOT NULL COLLATE 'utf8mb4_general_ci',
	daytime DATE NOT NULL,
	is_diary TINYINT(1) NOT NULL,
	PRIMARY KEY (diary_id) USING BTREE,
	INDEX user_id (user_id) USING BTREE,
	INDEX sentiment (sentiment) USING BTREE,
	CONSTRAINT diary_ibfk_1 FOREIGN KEY (user_id) REFERENCES user (user_id) ON UPDATE RESTRICT ON DELETE CASCADE,
	CONSTRAINT diary_ibfk_2 FOREIGN KEY (sentiment) REFERENCES sentiment (sentiment_id) ON UPDATE RESTRICT ON DELETE RESTRICT
)
COLLATE='utf8mb4_general_ci'
ENGINE=InnoDB
;

# 더미 데이터 삽입
INSERT INTO sentiment (sentiment_content) VALUES
('기쁨'),
('당황'),
('분노'),
('불안'),
('상처'),
('슬픔')
;

INSERT INTO user (email, hashed_token, nickname, disabled, disabled_at) VALUES
('test1@naver.com', 'test_hashed_token', 'nick_1', 0, NULL),
('test2@gmail.com', 'test_hashed_token', 'nick_2', 0, NULL),
('test3@naver.com', 'test_hashed_token', 'nick_3', 1, '2024-09-15'),
('test4@gmail.com', 'test_hashed_token', 'nick_4', 0, NULL),
('test5@email.com', 'test_hashed_token', 'nick_5', 1, '2024-05-13')
;

INSERT INTO question (question_content) VALUES
('오늘 가장 기억에 남는 순간은 무엇이었나요?'),
('오늘 나를 기분 좋게 만든 일이나 사람은 무엇/누구였나요?'),
('오늘 하루 중에서 나에게 어려움을 줬던 순간은 무엇이었나요? 그걸 어떻게 극복했나요?'),
('오늘 하루를 한마디로 표현하면 어떤 단어가 어울릴까요?'),
('오늘 나에게 새롭게 배운 점이나 깨달은 점이 있나요?'),
('오늘 느낀 감정 중 가장 강렬했던 감정은 무엇인가요? 그 감정의 원인은 무엇인가요?'),
('오늘 나를 행복하게 해준 것들에 대해 감사한 점을 적어보세요.'),
('오늘 누군가와 있었던 대화 중 기억에 남는 말이나 주제는 무엇인가요?'),
('오늘 나를 웃게 만든 일이나 작은 즐거움은 무엇이었나요?'),
('혹시 오늘 부정적인 생각이나 걱정이 있었다면, 그 생각에 대해 다시 한번 돌아보세요.'),
('이번 주에 이루고 싶은 작은 목표는 무엇인가요? 오늘 그 목표에 조금이라도 다가갔나요?'),
('오늘 하루를 통해 내일 더 잘할 수 있는 부분은 무엇일까요?'),
('내가 더 발전하기 위해 시도해본 새로운 일이나 방식이 있나요?'),
('이번 달에 이루고 싶은 목표가 있다면, 오늘 그 목표와 관련해 한 일은 무엇인가요?'),
('내 삶에서 내가 자랑스러워하는 순간들은 언제였나요? 오늘도 그런 순간이 있었나요?'),
('오늘 누군가에게 들었던 말 중에서 나에게 인상 깊었던 말은 무엇이었나요?'),
('오늘 도움을 주거나 받은 일이 있나요? 그때 어떤 기분이 들었나요?'),
('오늘 누군가와의 관계에서 어떤 긍정적인 변화가 있었나요?'),
('오늘 나를 떠올리게 만든 사람은 누구인가요? 그 사람에 대해 어떤 점을 생각했나요?'),
('최근 누군가에게 고마운 마음을 표현했나요? 아니면 내일 해보고 싶은가요?'),
('내일의 나에게 해주고 싶은 응원의 말이 있다면 무엇인가요?'),
('앞으로 다가올 일들 중 설레거나 기대되는 일은 무엇인가요?'),
('내일 시도해보고 싶은 작은 도전은 무엇인가요?'),
('오늘 내가 한 일 중 미래의 나에게 도움이 될 것 같은 일은 무엇인가요?'),
('다가올 미래에 대해 느끼는 감정은 무엇인가요? 기대감, 걱정, 아니면 설렘인가요?')
;

INSERT INTO quote (sentiment_id, quote_content) VALUES
(1, "기쁨은 세상의 소금이다. — 사무엘 존슨"),
(6, "슬픔은 강한 영혼이 다루는 대가이다. 깊이 슬퍼할 수 있는 사람만이 깊이 사랑할 수 있다. — 워싱턴 어빙"),
(2, "당황은 그 자체로 우리가 인간임을 보여주는 증거이다. — 마크 트웨인"),
(4, "불안은 불확실성에 대한 우리의 반응이지만, 그것이 우리의 현실을 지배하게 하지 말라. — 루이자 메이 올컷"),
(3, "분노는 당신을 불태우는 산불과 같아서, 결국에는 당신을 다 태워버린다. — 부처"),
(5, "우리가 고통을 겪는다고 해서 그것이 우리의 인생을 정의할 필요는 없다. — 마야 안젤루")
;

INSERT INTO diary (user_id, sentiment, diary_content, daytime, is_diary) VALUES
(1, 2, '다이어리 예시 당황인데 모델은 불안으로 느낌', '2023-01-21', 1),
(2, 2, '다이어리 예시 당황인데 모델은 불안으로 느낌', '2023-01-01', 0),
(3, 3, '다이어리 예시 당황인데 모델은 불안으로 느낌', '2023-01-02', 1),
(2, 1, '다이어리 예시 기쁨인데 모델은 분노로 느낌', '2023-06-02', 1),
(3, 4, '다이어리 예시 불안인데 모델은 상처로 느낌', '2024-03-23', 0),
(4, 6, '다이어리 예시 슬픔인데 모델은 당황으로 느낌', '2024-07-31', 1)
;
